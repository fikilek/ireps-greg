"use strict";(self.webpackChunknav=self.webpackChunknav||[]).push([[951],{8039:function(e,t,n){n.d(t,{Z:function(){return o}});n(2791);var a=n(184),o=function(e){return(0,a.jsx)("div",{className:"table-wrapper",children:e.children})}},951:function(e,t,n){n.d(t,{Z:function(){return D}});var a=n(9439),o=n(4942),s=n(1413),r=n(2481),l=n(2791),i=(n(5960),n(6849)),d=n(2918),c=n(3341),u=n(2040),v=n(9256),p=n(9900),f=n(2116),m=n(184),h=function(e){return e.children};function b(e){var t,n,o=(0,l.useRef)(),s=(0,d.Z)().openModal,r=(0,l.useState)(e.rowData),i=(0,a.Z)(r,2),c=i[0],b=i[1];(0,l.useEffect)((function(){b(e.rowData)}),[e.rowData]);var x=(0,f.Z)(),g=(x.setGeolocation,x.userGps),y=null===c||void 0===c?void 0:c.map((function(e){return{type:"Feature",properties:{cluster:!1,erfId:e.id,erf:e},geometry:{type:"Point",coordinates:[parseFloat(e.address.gps.longitude),parseFloat(e.address.gps.latitude)]}}})),j=(0,l.useState)([]),N=(0,a.Z)(j,2),Z=N[0],w=N[1],D=(0,l.useState)(10),C=(0,a.Z)(D,2),k=C[0],S=C[1],T=(0,v.Z)({points:y,bounds:Z,zoom:k,options:{radius:75,maxZoom:20}}),E=T.clusters,I=T.supercluster,M=(0,l.useState)(""),G=(0,a.Z)(M,2),A=G[0],R=G[1],F=(0,l.useState)(""),U=(0,a.Z)(F,2),B=U[0],K=U[1],z=(0,l.useState)(""),P=(0,a.Z)(z,2),W=P[0],H=P[1];(0,l.useEffect)((function(){var e=null===c||void 0===c?void 0:c.filter((function(e){return e.erfNo.includes(B)}));console.log("filteredErfs",e),H(e)}),[B]);var L=(null===B||void 0===B?void 0:B.length)>0?"show-erfs":"hide-erfs";(0,l.useEffect)((function(){if(A){var e,t,n,a,s,r,l=null===A||void 0===A||null===(e=A.address)||void 0===e||null===(t=e.gps)||void 0===t?void 0:t.latitude,i=null===A||void 0===A||null===(n=A.address)||void 0===n||null===(a=n.gps)||void 0===a?void 0:a.longitude;console.log("mapRef.current",o.current),null===(s=o.current)||void 0===s||s.panTo({lat:l,lng:i}),null===(r=o.current)||void 0===r||r.setZoom(20)}}),[A]);return(0,m.jsxs)("div",{className:"tabs-erfs-map",children:[(0,m.jsxs)("div",{className:"search-box",children:[(0,m.jsx)("input",{className:"erf-search",type:"text",placeholder:" enter erf no",onChange:function(e){return K(e.target.value)},value:B}),(0,m.jsx)("div",{className:"search-dropdown ".concat(L," "),children:W&&(null===W||void 0===W?void 0:W.map((function(e){var t,n,a,o,s=null===e||void 0===e?void 0:e.erfNo,r=null!==(t=e.propertyType)&&void 0!==t&&t.unitName?"| ".concat(null===(n=e.propertyType)||void 0===n?void 0:n.unitName):"",l=null!==(a=e.propertyType)&&void 0!==a&&a.unitNo?"| ".concat(null===(o=e.propertyType)||void 0===o?void 0:o.unitNo):"";return(0,m.jsx)("p",{onClick:function(){return function(e){R(e)}(e)},children:"".concat(s," ").concat(r," ").concat(l," ")},e.id)})))})]}),(0,m.jsxs)(u.ZP,{bootstrapURLKeys:{key:"AIzaSyCj8IfmDEGxDWEXesDKBanx6HDp_1jxluI"},defaultCenter:{lat:-26.56924,lng:28.32348},center:{lat:null===g||void 0===g||null===(t=g.coordinates)||void 0===t?void 0:t.lat,lng:null===g||void 0===g||null===(n=g.coordinates)||void 0===n?void 0:n.lng},defaultZoom:16,yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(e){var t,n,a,s,r=e.map;e.maps;o.current=r,null===(t=o.current)||void 0===t||null===(n=t.data)||void 0===n||n.loadGeoJson(p),null===(a=o.current)||void 0===a||null===(s=a.data)||void 0===s||s.setStyle({fillOpacity:0})},onChange:function(e){var t=e.zoom,n=e.bounds;S(t),w([n.nw.lng,n.se.lat,n.se.lng,n.nw.lat])},options:{mapTypeControl:!0,overviewMapControl:!0,rotateControl:!0,fullscreenControl:!1},children:[E.map((function(e){var t,n,r,l,i,d,u,v,p,f,b=(0,a.Z)(e.geometry.coordinates,2),x=b[0],g=b[1],j=e.properties,N=j.cluster,Z=j.point_count,w=null===e||void 0===e||null===(t=e.properties)||void 0===t||null===(n=t.erf)||void 0===n?void 0:n.erfNo,D=null===e||void 0===e||null===(r=e.properties)||void 0===r||null===(l=r.erf)||void 0===l?void 0:l.id,C=(null===e||void 0===e||null===(i=e.properties)||void 0===i||null===(d=i.erf)||void 0===d||null===(u=d.asts)||void 0===u?void 0:u.length)>0?"has-asts":"";null===e||void 0===e||null===(v=e.properties)||void 0===v||null===(p=v.erf)||void 0===p||null===(f=p.asts)||void 0===f||f.length;return N?(0,m.jsx)(h,{lat:g,lng:x,children:(0,m.jsx)("div",{className:"cluster-marker",style:{width:"".concat(10+Z/y.length*20,"px"),height:"".concat(10+Z/y.length*20,"px")},onClick:function(){var t=Math.min(I.getClusterExpansionZoom(e.id),20);o.current.setZoom(t),o.current.panTo({lat:g,lng:x})},children:Z})},"".concat(e.id)):(0,m.jsx)(h,{lat:g,lng:x,children:(0,m.jsx)("button",{className:"erf-marker",onClick:function(){return function(e,t,n){var a;null===(a=o.current)||void 0===a||a.panTo({lat:t,lng:n});var r=c.find((function(t){return t.id===e}));r&&s({modalName:"tabsErfMapInfoWrapper",payload:r})}(D,g,x)},children:(0,m.jsx)("span",{className:"erf-no ".concat(C," ").concat(""),children:w})})},"".concat(e.properties.erfId))})),(0,m.jsx)(h,{position:{lat:g.coordinates.lat,lng:g.coordinates.lng},children:(0,m.jsx)("div",{className:"userGpsPosition"})})]})]})}n(1350);var x=n(528),g=n(4867),y=n(8039),j=function(e,t,n,a,o){return"asts"===e||"trns"===e||"erfs"===e?null:(0,m.jsx)(g.Z,{nfd:a,fn:o})},N=function(e){var t=e.ml1,n=(e.tn,e.ml3,e.nfd),a=e.fn,o=e.rowData,s=e.columnDefs,r=e.setSelectedRows;return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(y.Z,{rowData:o,columnDefs:s,ml1:t,children:(0,m.jsx)(x.Z,{rowData:o,columnDefs:s,setSelectedRows:r,ml1:t})}),j(t,0,0,n,a)]})},Z=function(e,t,n){var a=[];return 0===e.lenght?a:e?(e.map((function(e){var l={};if("inspection"===t&&!(l=function(e){console.log("erf",e);var t=e.asts;if(console.log("asts",t),!t)return null;var n={};return t&&t.forEach((function(e){var t=e.astId;console.log("astId",t);var a=e.astData.astCartegory,r=c.m[a].inspection.trnData;if(e=(0,s.Z)((0,s.Z)({},e),{},{trnData:r}),a)if(n[a]){var l=n[a].some((function(e){return e.astId===t}));if(l){delete e.trnMetaData,delete e.astData,delete e.astId;var i=Object.entries(e)[0][0],d=n[a].findIndex((function(e){return e.astId===t}));n[a][d]=(0,s.Z)((0,s.Z)({},n[a][d]),{},(0,o.Z)({},i,e[i]))}else n[a].push(e)}else n[a]=[],delete e.trnMetaData,n[a].push(e)})),n}(e)))return null;if("installation"===t||"audit"===t||"inspection"===t){var i={metaData:{createdAtDatetime:r.EK.now(),createdByUser:n.displayName,createdByUserId:n.uid,updatedAtDatetime:r.EK.now(),updatedByUser:n.displayName,trnHistory:0,trnType:t,trnNo:"",trnState:"draft"},erfData:e,astData:l};return a.push(i)}})),a):void 0},w=[{key:"choose",value:"choose"},{key:"audit",value:"audit"},{key:"inspection",value:"inspection"}],D=function(e){var t=(0,l.useState)(""),n=(0,a.Z)(t,2),o=n[0],r=n[1],c=e.purpose,u=(0,l.useState)("tabs-map"),v=(0,a.Z)(u,2),p=v[0],f=v[1],h=(0,l.useState)([]),x=(0,a.Z)(h,2),g=x[0],y=x[1],j=(0,d.Z)().openModal,D=(0,i.Z)().user,C=function(e){f(e.target.id)};return(0,l.useEffect)((function(){r("choose")}),[]),(0,m.jsxs)("div",{className:"tabs",children:[(0,m.jsxs)("div",{className:"tabs-header",children:[(0,m.jsx)("div",{className:"tab-title",children:(0,m.jsx)("p",{children:"Erfs Table"})}),"firestoreErfs"===c?(0,m.jsxs)("div",{className:"new-trn-div",children:[" ",(0,m.jsx)("button",{className:"new-trn new-trn-btn",disabled:"choose"===o||0===g.length,onClick:function(){if(o){var e=Z(g,o,D);e.length>0&&(j({modalName:"tableTrnsFromErfs",payload:{newTrnsArray:e,trnType:o}}),r("choose"))}},children:"NT"})," ",(0,m.jsx)("select",{className:"new-trn new-trn-select",value:o,onChange:function(e){return r(e.target.value)},placeholder:"Store Name",children:w&&w.map((function(e){return(0,m.jsx)("option",{value:e.value,children:e.value},e.key)}))})]}):(0,m.jsx)("div",{}),(0,m.jsxs)("div",{className:"tabs-btns",children:[" ",(0,m.jsx)("div",{className:"tabs-header-table ".concat("tabs-table"===p?"tab-active":""," tabs-tab"),id:"tabs-table",onClick:C,children:"Table"}),(0,m.jsx)("div",{className:"tabs-header-map ".concat("tabs-map"===p?"tab-active":""," tabs-tab"),id:"tabs-map",onClick:C,children:"Map"})]})]}),(0,m.jsxs)("div",{className:"tabs-body",children:[(0,m.jsx)("div",{className:"tabs-body-content tabs-table ".concat("tabs-table"===p?"tabs-show":"tabs-hide","  "),id:"tabs-table",children:(0,m.jsx)(N,(0,s.Z)((0,s.Z)({},e),{},{setSelectedRows:y}))}),(0,m.jsx)("div",{className:"tabs-body-content tabs-map ".concat("tabs-map"===p?"tabs-show":"tabs-hide"," "),id:"tabs-map",children:(0,m.jsx)(b,(0,s.Z)({},e))}),(0,m.jsx)("div",{className:"tabs-body-content tabs-tree ".concat("tabs-tree"===p?"tabs-show":"tabs-hide"," "),id:"tabs-tree"})]})]})}}}]);
//# sourceMappingURL=951.8e2c8960.chunk.js.map